<navbar id="navbar"></navbar>
<script>$("#navbar").load(`/views/imports/navbar.html`, function(response, status, xhr) { })</script>
<div class="body">
  <div class="margin-top2" style="margin-top: 12vh; margin-inline: 2vw;">
    <div class="font-2 font-size2" style="font-size: 4vh; font-weight: 600; display: flex; flex-direction: row;">
      <div class="width35" style="width: 80%; display: flex; align-items: center;">
        <a>Propostas no Robo:</a>
      </div>
      <div class="width40" style="width: 20%; display: flex; flex-direction: row; justify-content: right; align-items: center;">
        <a onclick="openTokens()" class="invisibleAndroid font-color-navbar font-1" style="text-decoration: underline; font-weight: 800; font-size: 2vh; margin-right: 1vw; cursor: pointer">Tokens</a>
        <i id="refresh" onclick="refresh()" title="Atualizar Propostas" class="fad fa-sync font-size2" style="font-size: 3vh; margin-right: 1.2vw; cursor: pointer"></i>
        <a id="cadastrar" onclick="cadastrar()" class="buttonLogin font-2 font-size1-5" style="font-size: 3vh; padding-inline: 3vh; padding-block: 1vh; border-radius: 1vh; margin-right: 1vw">Cadastrar</a>
        <input id="selectAll" class="width3 height3vw" onclick="toggleAllCheckBox(this)" title="Selecionar Todos" type="checkbox" style="width: 2.5vh; height: 2.5vh;">
      </div>
    </div>
    <a onclick="openTokens()" class="visibleAndroid font-color-navbar font-1" style="text-decoration: underline; font-weight: 800; font-size: 1.5vh; margin-right: 1vw; cursor: pointer">Tokens</a>
    <div id="propostas" style="margin-top: 2vh; margin-bottom: 2vh;">
      <!-- <div id="proposta${index}">
        <div class="background-Propostas width79" style="position: relative; margin-bottom: 2vh; width: 91.5vw; height: 16vh; border-radius: 1vh; font-size: 2.2vh;">
          <div class="line-bottom navbar-font-color font-4 width77" style="display: flex; flex-direction: row; height: 6vh; width: 89.5vw; padding-inline: 1vw; align-items: center;">
            <div class="width56-5" style="display: flex; flex-direction: row; width: 81vw; max-width: 81vw; overflow: hidden">
              <div class="max-width22-5 font-size2" title="${element.BancoContrato}" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 11vw">
                <a><i class="far fa-landmark font-size2" style="font-size: 2.8vh"></i><span class="invisibleAndroid"> BANCO: </span>${element.BancoContrato}</a>
              </div>
              <div class="max-width14 font-size2" title="${element.orgaoPropostaName}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 9vw">
                <a><i class="far fa-bookmark font-size2" style="font-size: 2.8vh"></i><span class="invisibleAndroid"> ORGÃO: </span>${element.orgaoPropostaName}</a>
              </div>
              <div class="invisibleAndroid" title="${element.Valor}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 12vw">
                <a><i class="far fa-sack-dollar" style="font-size: 2.8vh"></i> VL. AF: ${element.Valor}</a>
              </div>
              <div class="invisibleAndroid" title="${element.Prazo}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 8vw">
                <a><i class="fal fa-table" style="font-size: 2.8vh"></i> PRAZO: ${element.Prazo}</a>
              </div>
              <div class="max-width18 font-size2" title="${element.IdContrato}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 11vw">
                <a><i class="far fa-file-code font-size2" style="font-size: 2.8vh"></i><span class="invisibleAndroid"> COD. AF: </span>${element.IdContrato}</a>
              </div>
              <div class="invisibleAndroid" title="${element.Tabela}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 12vw">
                <a><i class="far fa-table" style="font-size: 2.8vh"></i> TABELA: ${element.Tabela}</a>
              </div>
            </div>
            <div class="width20-5" style="display: flex; flex-direction: row; width: 8.5vw; max-width: 8.5vw; overflow: hidden; justify-content: right; align-items: center;">
              <i title="Acompanhamento" class="fad fa-file-search" style="font-size: 2.5vh; cursor: not-allowed"></i>
              <i title="Editar Proposta" class="fad fa-edit" style="margin-left: 1vh; font-size: 2.5vh; cursor: not-allowed"></i>
              <input class="width3 height3vw" id="${index}" onclick="toggleCheckBox(this)" name="box" title="Selecionar" type="checkbox" style="margin-left: 1vh; width: 0.9vw; height:0.9vw;">
            </div>
          </div>
          <div class="width77" style="display: flex; flex-direction: row; height: 9vh; width: 89.5vw; padding-inline: 1vw; align-items: center;">
            <div class="width66-5" style="display: flex; flex-direction: row; width: 87vw; max-width: 87vw; overflow: hidden;">
              <fieldset class="width18 font-size2" title="${element.NomeCliente}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 15vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Nome</legend>
                <input class="width18 font-size2" value="${element.NomeCliente}" class="font-color" id="name" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 15vw; height: 3vh; border: 0; background: transparent; ${element.NomeCliente.length > 35 ? 'color: red;' : ''}" disabled>
              </fieldset>
              <fieldset class="width16 font-size2" title="${element.Cpf}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 8vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">CPF</legend>
                <input class="width16 font-size2" value="${element.Cpf}" class="font-color" id="cpf" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 8vw; height: 3vh; border: 0; background: transparent; ${element.Cpf.length != 11 ? 'color: red;' : ''}" disabled>
              </fieldset>
              <fieldset class="invisibleAndroid" title="${element.rg}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 5vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">RG</legend>
                <input value="${element.rg}" class="font-color" id="rg" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 5vw; height: 3vh; border: 0; background: transparent;" disabled>
              </fieldset>
              <fieldset class="invisibleAndroid" title="${element.Cep}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 7vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">CEP</legend>
                <input value="${element.Cep}" class="font-color" id="cep" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 7vw; height: 3vh; border: 0; background: transparent; ${element.Cep.length != 8 ? 'color: red;' : ''}" disabled>
              </fieldset>
              <fieldset class="invisibleAndroid" title="${element.BancoCliente}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 10vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Banco</legend>
                <input value="${element.BancoCliente}" class="font-color" id="banco" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 10vw; height: 3vh; border: 0; background: transparent;" disabled>
              </fieldset>
              <fieldset class="invisibleAndroid" title="${element.Agencia}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 5vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Agência</legend>
                <input value="${element.Agencia}" class="font-color" id="agencia" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 5vw; height: 3vh; border: 0; background: transparent; ${element.Agencia.length != 4 && element.BancoContrato != 'MERCANTIL' ? 'color: red;' : ''}" disabled>
              </fieldset>
              <fieldset class="invisibleAndroid" title="${element.ContaCorrente}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 8vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Conta</legend>
                <input value="${element.ContaCorrente}" class="font-color" id="conta" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 8vw; height: 3vh; border: 0; background: transparent;" disabled>
              </fieldset>
              <fieldset class="width27-5 font-size2" id="situacaoTitle${index}" title="Aguardando Cadastro..." style="font-size: 2.4vh; border-radius: 0.6vh; width: 17.9vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
                <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Situação</legend>
                <input class="width27-5 font-size2" value="Aguardando Cadastro..." class="font-color" id="situacao${index}" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 17.9vw; height: 3vh; border: 0; background: transparent;" disabled>
              </fieldset>
            </div>
            <div class="width10-5" class="navbar-font-color font-4" style="display: flex; height: 9vh; flex-direction: row; width: 2.5vw; max-width: 2.5vw; overflow: hidden; justify-content: right; align-items: center;">
              <i title="Editar Usuário" class="navbar-font-color fad fa-user-edit" style="font-size: 2.5vh; cursor: not-allowed; margin-top: 0.1vh"></i>
            </div>
          </div>
        </div>
      </div> -->
    </div>
    <div style="margin-top: 5vh">
      <div class="width35" style="font-size: 3vh; width: 80%; display: flex; align-items: center;">
        <a>Propostas Cadastradas:</a>
      </div>
      <div id="cadastradas" style="margin-top: 2vh; margin-bottom: 2vh;">
      </div>
    </div>
  </div>
</div>
<div id="tokens" class="background-reverse" style="display: none; position: fixed; top: 30%; left: 20%; width: 60%; padding-inline: 2%; padding-block: 1%; border-radius: 2vh; box-shadow: 1vh 0.3vh 2vh 0vh rgba(0, 0, 0, 0.5), 0 2vh 2vh 0 rgba(0, 0, 0, 0.5);">
  <div style="display: flex; flex-direction: row">
    <a style="font-size: 3vh">Tokens:</a>
    <i onclick="openTokens()" class="far fa-times padding-right3" style="cursor: pointer; display: flex; width: 100%; justify-content: right; font-size: 3.5vh; padding-right: 1.5vw"></i>
  </div>
  <div style="width: 100%; display: flex; justify-content: center;">
    <fieldset id="fieldset" class="font-size2" title="Coloque o Token..." style="font-size: 2.4vh; border-radius: 0.6vh; width: 100%; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; ">
      <legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">BMG</legend>
      <input id="tokenBMG" class="font-1 font-color-reverse" placeholder="000000" style="width: 100%; height: 3vh; margin: 0; font-size: 2.3vh; background: transparent; border: 0">
    </fieldset>
  </div>
</div>
<script>
  var tokens = false
  function openTokens() {
    if (tokens) {
      tokens = false
      document.getElementById('tokens').style.display = 'none'
    } else {
      tokens = true
      document.getElementById('tokens').style.display = 'inline'
    }
  }
</script>
<script>
  var checkeds = []
  function toggleAllCheckBox(source) {
    checkboxes = document.getElementsByName('box');
    for(var i=0, n=checkboxes.length; i<n;i++) {
      if (checkboxes[i].id == "selectAll") return;
      checkboxes[i].checked = source.checked;
      if (checkboxes[i].id && propostas[checkboxes[i].id] && source.checked) {
        checkeds[checkeds.length] = {
          index: checkboxes[i].id,
          Cpf: propostas[checkboxes[i].id].Cpf,
          IdContrato: propostas[checkboxes[i].id].IdContrato,
          orgaoProposta: propostas[checkboxes[i].id].orgaoProposta,
        }
      } else if (propostas[checkboxes[i].id] && checkeds.findIndex(r=>r.Cpf == propostas[checkboxes[i].id].Cpf && r.IdContrato == propostas[checkboxes[i].id].IdContrato) >= 0) {
        checkeds.splice(checkeds.findIndex(r=>r.Cpf == propostas[checkboxes[i].id].Cpf && r.IdContrato == propostas[checkboxes[i].id].IdContrato), 1)
      }
    }
  }
  function toggleCheckBox(source) {
    if (source.id == "selectAll") return;
    if (propostas[source.id] && source.checked) {
      checkeds[checkeds.length] = {
        index: source.id,
        Cpf: propostas[source.id].Cpf,
        IdContrato: propostas[source.id].IdContrato,
        orgaoProposta: propostas[source.id].orgaoProposta,
      }
    } else if (propostas[source.id] && checkeds.findIndex(r=>r.Cpf == propostas[source.id].Cpf && r.IdContrato == propostas[source.id].IdContrato) >= 0) {
      checkeds.splice(checkeds.findIndex(r=>r.Cpf == propostas[source.id].Cpf && r.IdContrato == propostas[source.id].IdContrato), 1)
    }
  }
</script>
<script>
  var propostas = []
  function copyClient(i) {
    if (propostas[i]) {
      navigator.clipboard.writeText(JSON.stringify(propostas[i]).replaceAll(",","\n"));
      alert(`Os dados do cliente '${propostas[i].NomeCliente}' foram copiadas com sucesso!`)
    } else return alert('Proposta não encontrada...')
  }
  var mudandofase = false
  function mudarFase(i) {
    if (mudandofase) return alert('Você já está mudando a fase de uma propostas! Aguarde...')
    mudandofase = true
    if (propostas[i]) {
      $.ajax({ type: "post",url: `https://api.concredito.com.br/propostas/changeFase`,
        data: JSON.stringify({
          user: localStorage.getItem('user'),
          password: localStorage.getItem('password'),
          proposta: propostas[i]
        }), contentType:"application/json; charset=utf-8",
        success: async function(s) {
          if (s.error) return alert(s.error)
          alert('Fase da proposta alterada com sucesso!')
          apagando = false
          return location.reload()
        },
        error: function(e) {
          apagando = false
          if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
          return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
        }
      })
    } else return alert('Proposta não encontrada...')
  }
  var apagando = false
  function deleteProposta(i) {
    if (apagando) return alert('Você já está apagando uma propostas! Aguarde...')
    apagando = true
    if (propostas[i]) {
      $.ajax({ type: "post",url: `https://api.concredito.com.br/propostas/delete`,
        data: JSON.stringify({
          user: localStorage.getItem('user'),
          password: localStorage.getItem('password'),
          proposta: propostas[i]
        }), contentType:"application/json; charset=utf-8",
        success: async function(s) {
          if (s.error) return alert(s.error)
          alert('Proposta apagada com sucesso!')
          apagando = false
          return location.reload()
        },
        error: function(e) {
          apagando = false
          if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
          return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
        }
      })
    } else return alert('Proposta não encontrada...')
  }
  function refresh() {
    propostas = []
    checkeds = []
    if (document.getElementById('cadastrar').classList.contains('buttonBlock')) return alert('Aguarde...')
    document.getElementById('refresh').style.cursor = "not-allowed"
    document.getElementById('cadastrar').classList.add("buttonBlock");
    document.getElementById('propostas').innerHTML = `<div style="position: absolute; top: 20vh; left: 50%; margin-top: 0vh; margin-left: -2vh"><div class="loader-wheel"></div><div class="loader-text font-5"></div></div>`
    document.getElementById('selectAll').checked = false
    $.ajax({ type: "post",url: `https://api.concredito.com.br/propostas/lista`,
      data: JSON.stringify({
        user: localStorage.getItem('user'),
        password: localStorage.getItem('password') 
      }), contentType:"application/json; charset=utf-8",
      success: async function(s) {
        if (s.error) return alert(s.error)
        document.getElementById('propostas').innerHTML = ``
        if (s.FGTS.length >= 1) {
          await s.FGTS.forEach((element, index)=> {
            element.orgaoProposta = "FGTS";
            element.orgaoPropostaName = "FGTS";
            propostas[propostas.length] = element;
          })
        }
        if (s.INSS.length >= 1) { 
          await s.INSS.forEach((element, index)=> {
            element.orgaoProposta = "INSS";
            element.orgaoPropostaName = "INSS";
            propostas[propostas.length] = element;
          })
        }
        if (s.CART.length >= 1) {
          await s.CART.forEach((element, index)=> {
            element.orgaoProposta = "CART";
            element.orgaoPropostaName = "CARTÃO";
            propostas[propostas.length] = element;
          })
        }
        if (s.MongoDB.length >= 1) {
          await s.MongoDB.forEach((element, index)=> {
            element.orgaoProposta = element.Orgao;
            element.orgaoPropostaName = element.Orgao;
            element.BancoCliente = element.CodBancoCliente
            element.IdContrato = element.Cpf
            propostas[propostas.length] = element;
          })
        }
        if (s.MongoDBSucess.length >= 1) {
          await s.MongoDBSucess.forEach((element, index)=> {
            element.cadastrado = true
            element.orgaoProposta = element.Orgao;
            element.orgaoPropostaName = element.Orgao;
            element.BancoCliente = element.CodBancoCliente
            element.IdContrato = element.Cpf
            propostas[propostas.length] = element;
          })
        }
        if (propostas.length >= 1) {
          propostas.forEach((element, index)=> {
            var test = `<div id="proposta${index}"><div class="background-Propostas width79" style="position: relative; margin-bottom: 2vh; width: 91.5vw; height: 16vh; border-radius: 1vh; font-size: 2.2vh;"><div class="line-bottom navbar-font-color font-4 width77" style="display: flex; flex-direction: row; height: 6vh; width: 89.5vw; padding-inline: 1vw; align-items: center;"><div class="width56-5" style="display: flex; flex-direction: row; width: 81vw; max-width: 81vw; overflow: hidden"><div class="max-width22-5 font-size2" title="${element.BancoContrato}" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 22vw"><a><i class="far fa-landmark font-size2" style="font-size: 2.8vh"></i><span class="invisibleAndroid"> BANCO: </span>${element.BancoContrato}</a></div><div class="max-width14 font-size2" title="${element.orgaoPropostaName}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 9vw"><a><i class="far fa-bookmark font-size2" style="font-size: 2.8vh"></i><span class="invisibleAndroid"> ORGÃO: </span>${element.orgaoPropostaName}</a></div><div class="invisibleAndroid" title="${element.Valor}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 12vw"><a><i class="far fa-sack-dollar" style="font-size: 2.8vh"></i> VL. AF: ${element.Valor}</a></div><div class="invisibleAndroid" title="${element.Prazo}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 8vw"><a><i class="fal fa-table" style="font-size: 2.8vh"></i> PRAZO: ${element.Prazo}</a></div><div class="max-width18 font-size2" title="${element.IdContrato}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 11vw"><a><i class="far fa-file-code font-size2" style="font-size: 2.8vh"></i><span class="invisibleAndroid"> COD. AF: </span>${element.IdContrato}</a></div><div class="invisibleAndroid" title="${element.Tabela}" style="margin-left: 1vw; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 12vw"><a><i class="far fa-table" style="font-size: 2.8vh"></i> TABELA: ${element.Tabela}</a></div></div><div class="width20-5" style="display: flex; flex-direction: row; width: 8.5vw; max-width: 8.5vw; overflow: hidden; justify-content: right; align-items: center;"><i title="Acompanhamento" class="fad fa-file-search" style="font-size: 2.5vh; cursor: not-allowed"></i><i title="Editar Proposta" class="fad fa-edit" style="margin-left: 1vh; font-size: 2.5vh; cursor: not-allowed"></i><i onclick="mudarFase('${index}')" style="font-size: 2.5vh; cursor: pointer; margin-inline: 0.3vw" title="Mudar Fase" class="fas fa-exchange font-color-navbar"></i><i onclick="deleteProposta('${index}')" style="font-size: 2.5vh; cursor: pointer; margin-inline: 0.3vw" title="Deletar proposta" class="fas fa-times font-color-navbar"></i><input class="width3 height3vw" id="${index}" onclick="toggleCheckBox(this)" name="box" title="Selecionar" type="checkbox" style="margin-left: 1vh; width: 0.9vw; height:0.9vw;"></div></div><div class="width77" style="display: flex; flex-direction: row; height: 9vh; width: 89.5vw; padding-inline: 1vw; align-items: center;"><div class="width66-5" style="display: flex; flex-direction: row; width: 87vw; max-width: 87vw; overflow: hidden;"><fieldset class="width18 font-size2" title="${element.NomeCliente}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 15vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Nome</legend><input class="width18 font-size2" value="${element.NomeCliente}" class="font-color" id="name" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 15vw; height: 3vh; border: 0; background: transparent; ${element.NomeCliente.length > 35 ? 'color: red;' : ''}" disabled></fieldset><fieldset class="width16 font-size2" title="${element.Cpf}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 8vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">CPF</legend><input class="width16 font-size2" value="${element.Cpf}" class="font-color" id="cpf" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 8vw; height: 3vh; border: 0; background: transparent; ${element.Cpf.length != 11 ? 'color: red;' : ''}" disabled></fieldset><fieldset class="invisibleAndroid" title="${element.rg}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 5vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">RG</legend><input value="${element.rg}" class="font-color" id="rg" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 5vw; height: 3vh; border: 0; background: transparent;" disabled></fieldset><fieldset class="invisibleAndroid" title="${element.Cep}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 7vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">CEP</legend><input value="${element.Cep}" class="font-color" id="cep" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 7vw; height: 3vh; border: 0; background: transparent; ${element.Cep.length != 8 ? 'color: red;' : ''}" disabled></fieldset><fieldset class="invisibleAndroid" title="${element.BancoCliente}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 10vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Banco</legend><input value="${element.BancoCliente}" class="font-color" id="banco" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 10vw; height: 3vh; border: 0; background: transparent;" disabled></fieldset><fieldset class="invisibleAndroid" title="${element.Agencia}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 5vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Agência</legend><input value="${element.Agencia}" class="font-color" id="agencia" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 5vw; height: 3vh; border: 0; background: transparent; ${element.Agencia.length != 4 && element.BancoContrato != 'MERCANTIL' ? 'color: red;' : ''}" disabled></fieldset><fieldset class="invisibleAndroid" title="${element.ContaCorrente}" style="font-size: 2.4vh; border-radius: 0.6vh; width: 8vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Conta</legend><input value="${element.ContaCorrente}" class="font-color" id="conta" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 8vw; height: 3vh; border: 0; background: transparent;" disabled></fieldset><fieldset class="width27-5 font-size2" id="situacaoTitle${index}" title="Aguardando Cadastro..." style="font-size: 2.4vh; border-radius: 0.6vh; width: 17.9vw; height: 7vh; padding: 0; padding-inline: 0.4vw; margin: 0; margin-left: 0.5vw; "><legend class="font-4" style="margin: 0; padding: 0; font-size: 2.3vh">Situação</legend><input class="width27-5 font-size2" value="${element.cadastrado ? element.link ? element.link+' - '+element.CodigoContrato : 'Contrato: '+element.CodigoContrato : 'Aguardando Cadastro...'}" class="font-color" id="situacao${index}" type="text" style="margin: 0; padding: 0; font-size: 2.3vh; width: 17.9vw; height: 3vh; border: 0; background: transparent;" disabled></fieldset></div>
            <div class="width10-5" class="navbar-font-color font-4" style="display: flex; height: 9vh; flex-direction: column; width: 2.5vw; max-width: 2.5vw; overflow: hidden; height: 5vh; align-items: center; justify-content: right; align-items: center;"><i title="Editar Usuário" class="navbar-font-color fad fa-user-edit" style="font-size: 2.5vh; cursor: not-allowed; margin-top: 0.1vh"></i><i onclick="copyClient('${index}')" style="font-size: 2vh; cursor: pointer; margin-top: 0.3vh" title="Copiar dados do cliente" class="fas fa-copy font-color-navbar"></i></div></div></div></div>`
            if (element.cadastrado) {
              document.getElementById('cadastradas').innerHTML += test
            } else {
              document.getElementById('propostas').innerHTML += test
              checkSituation(element, index, "Aguardando Cadastro...")
            }
          })
        } else document.getElementById('propostas').innerHTML += `<div style="width: 100%; text-align: center; height: 0.2vh; background: rgb(50,50,50)"></div><div class="font-1" style="text-align: center; margin-top: 2vh; font-size: 2vh; font-weight: 0;"><a>Nenhuma proposta no robo</a></div>`
        document.getElementById('cadastrar').classList.remove("buttonBlock");
        document.getElementById('refresh').style.cursor = "pointer"
      },
      error: function(e) {
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      }
    })
  }
  function cadastrar() {
    if (checkeds.length <= 0) return alert('Selecione as propostas...')
    if (document.getElementById('cadastrar').classList.contains('buttonBlock')) return alert('Aguarde...')
    document.getElementById('cadastrar').classList.add("buttonBlock");
    document.getElementById('refresh').style.cursor = "not-allowed"
    checkeds.forEach((element, index)=> {
      if (document.getElementById(`situacao${element.index}`).value != "Aguardando Cadastro...") return;
      document.getElementById(`situacao${element.index}`).style.color = `blue`
      document.getElementById(`situacao${element.index}`).value = `Iniciando Cadastro...`
      document.getElementById(`situacaoTitle${element.index}`).title = `Iniciando Cadastro...`
      setTimeout(function(){ checkSituation(element, element.index, "Aguardando Cadastro...", true) }, 500)
      $.ajax({ type: "post",url: `https://api.concredito.com.br/propostas/register`,
      data: JSON.stringify({
        user: localStorage.getItem('user'),
        password: localStorage.getItem('password'),
        proposta: element,
        tokenBMG: document.getElementById(`tokenBMG`) && document.getElementById(`tokenBMG`).value ? document.getElementById(`tokenBMG`).value : false,
      }), contentType:"application/json; charset=utf-8",
        success: async function(s) {
          if (s.status) {
            document.getElementById(`situacao${element.index}`).style.color = `green`
            document.getElementById(`situacao${s.proposta.index}`).value = s.data
            document.getElementById(`situacaoTitle${s.proposta.index}`).title = s.data
          } else if (s.error) {
            document.getElementById(`situacao${element.index}`).style.color = `red`
            document.getElementById(`situacao${s.proposta.index}`).value = s.error
            document.getElementById(`situacaoTitle${s.proposta.index}`).title = s.error
          } else {
            document.getElementById(`situacao${element.index}`).style.color = `red`
            document.getElementById(`situacao${s.proposta.index}`).value = 'Ocorreu algum erro indefinido...'
            document.getElementById(`situacaoTitle${s.proposta.index}`).title = 'Ocorreu algum erro indefinido...'
          }
          document.getElementById('cadastrar').classList.remove("buttonBlock");
          document.getElementById('refresh').style.cursor = "pointer"
        },
        error: function(e) {
          if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
          return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
        }
      })
    })
  }
  function checkSituation(element, index, situation, action) {
    $.ajax({ type: "post", url: `https://api.concredito.com.br/propostas/situation`,
      data: JSON.stringify({
        user: localStorage.getItem('user'),
        password: localStorage.getItem('password'),
        proposta: element,
        situation: situation
      }), contentType:"application/json; charset=utf-8",
      success: async function(s) {
        if (s.status) {
          if (status == "error") {
            document.getElementById(`situacao${index}`).style.color = `orange`
          } else if (!action && (s.data.includes('https://'))) {
            return document.getElementById(`proposta${index}`).innerHTML = ``
          } else document.getElementById(`situacao${index}`).style.color = `blue`
          document.getElementById(`situacao${index}`).value = s.data
          document.getElementById(`situacaoTitle${index}`).title = s.data
          checkSituation(element, index, s.data, action)
        } else if (!action && document.getElementById(`situacao${index}`).value != "Aguardando Cadastro...") {
          return document.getElementById(`proposta${index}`).innerHTML = ``
        } else if (action && document.getElementById(`situacao${index}`).value == "Iniciando Cadastro...") {
          return checkSituation(element, index, "Aguardando Cadastro...", action)
        }
      },
      error: function(e) {
        if (e && e.responseJSON && e.responseJSON.error) return alert(e.responseJSON.error)
        return alert(`Ocorreu algum erro indefinido! Tente novamente mais tarde...`)
      },
    })
  }
  (function () {
    refresh()
  })();
</script>